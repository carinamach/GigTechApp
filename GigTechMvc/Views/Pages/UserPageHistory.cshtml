@page
@model GigTechMvc.Views.Pages.UserPageModel
@inject GigTechContext _dbContext
@using GigTech.Shared
@using Microsoft.AspNetCore.Identity
@inject UserManager<IdentityUser> UserManager

@{
    var products = ViewBag.Products as List<Product>;
    var orders = ViewBag.OrderDetails as List<OrderDetail>;
    var userId = await UserManager.GetUserAsync(User);
    var userEmail = userId.Email;

    // Retrieve customer based on user's email
    var dbCustomer = _dbContext.Customers.FirstOrDefault(c => c.Email == userEmail);

}

<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" />
    <title>User Profile</title>
    <link rel="stylesheet" href="/css/userpagestyle.css">
    <script src="~/js/userpage.js"></script>
</head>
<body>
    <div id="topBorder">
        <div id="topBorder_img">
            <img id="" src="@dbCustomer.ProfileImage" />
        </div>
        <div id="topBorder-left">
            <h2>@dbCustomer.Username</h2>
            <p><strong style="color: orangered">@dbCustomer.VMoney</strong> vMoney</p>
        </div>
        <div id="topBorder-right">
            <a asp-controller="UserPage" asp-action="UserPage" class="icon-button">
                <div class="icon">
                    <img src="https://i.ibb.co/cXZKtxh/editprofile-icon.png" alt="yourprofile">
                    <p>PROFILE</p>
                </div>
            </a>
            <a asp-controller="UserPage" asp-action="UserPageEdit" class="icon-button">
                <div class="icon">
                    <img src="https://i.ibb.co/cXZKtxh/editprofile-icon.png" alt="editprofile">
                    <p>EDIT</p>
                </div>
            </a>
            <a asp-controller="UserPage" asp-action="UserPageHistory" class="icon-button">
                <div class="icon">
                    <img src="https://i.ibb.co/cXZKtxh/editprofile-icon.png" alt="History">
                    <p>ORDERS</p>
                </div>
            </a>
        </div>
    </div>

    <div class="profileGames">
        <div id="yourGames-text">
            <h3>ORDER HISTORY</h3>
            @foreach (var order in orders)
            {
                <p>Order ID: @order.Id</p>
                <p>Product ID: @order.ProductId</p>
                <p>Quantity: @order.OrderDate</p>
                <p>Price: @order.TotalAmount</p>
                <hr />
            }

        </div>



    </div>

    <div class="profile-shopcontainer">
        <div id="profile-shopcontainerGames">
            <h3>GAME LIBRARY</h3>

            <div class="side-scroll">
                @foreach (var game in products) // Iterate through all games
                {
                    <div class="gamelib">
                        <img src="@game.ImageOne" alt="@game.Title" class="game-image">
                        <p>@game.Title</p>
                    </div>
                }
            </div>
        </div>
    </div>

</body>
</html>
